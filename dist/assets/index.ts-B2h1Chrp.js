import{g as F}from"./storage-hRoG6Hut.js";var R={exports:{}},P;function U(){return P||(P=1,(function(w){var l=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},m=-1,g=1,v=0;l.Diff=function(e,r){return[e,r]},l.prototype.diff_main=function(e,r,n,i){typeof i>"u"&&(this.Diff_Timeout<=0?i=Number.MAX_VALUE:i=new Date().getTime()+this.Diff_Timeout*1e3);var a=i;if(e==null||r==null)throw new Error("Null input. (diff_main)");if(e==r)return e?[new l.Diff(v,e)]:[];typeof n>"u"&&(n=!0);var t=n,s=this.diff_commonPrefix(e,r),h=e.substring(0,s);e=e.substring(s),r=r.substring(s),s=this.diff_commonSuffix(e,r);var o=e.substring(e.length-s);e=e.substring(0,e.length-s),r=r.substring(0,r.length-s);var f=this.diff_compute_(e,r,t,a);return h&&f.unshift(new l.Diff(v,h)),o&&f.push(new l.Diff(v,o)),this.diff_cleanupMerge(f),f},l.prototype.diff_compute_=function(e,r,n,i){var a;if(!e)return[new l.Diff(g,r)];if(!r)return[new l.Diff(m,e)];var t=e.length>r.length?e:r,s=e.length>r.length?r:e,h=t.indexOf(s);if(h!=-1)return a=[new l.Diff(g,t.substring(0,h)),new l.Diff(v,s),new l.Diff(g,t.substring(h+s.length))],e.length>r.length&&(a[0][0]=a[2][0]=m),a;if(s.length==1)return[new l.Diff(m,e),new l.Diff(g,r)];var o=this.diff_halfMatch_(e,r);if(o){var f=o[0],u=o[1],c=o[2],_=o[3],b=o[4],p=this.diff_main(f,c,n,i),M=this.diff_main(u,_,n,i);return p.concat([new l.Diff(v,b)],M)}return n&&e.length>100&&r.length>100?this.diff_lineMode_(e,r,i):this.diff_bisect_(e,r,i)},l.prototype.diff_lineMode_=function(e,r,n){var i=this.diff_linesToChars_(e,r);e=i.chars1,r=i.chars2;var a=i.lineArray,t=this.diff_main(e,r,!1,n);this.diff_charsToLines_(t,a),this.diff_cleanupSemantic(t),t.push(new l.Diff(v,""));for(var s=0,h=0,o=0,f="",u="";s<t.length;){switch(t[s][0]){case g:o++,u+=t[s][1];break;case m:h++,f+=t[s][1];break;case v:if(h>=1&&o>=1){t.splice(s-h-o,h+o),s=s-h-o;for(var c=this.diff_main(f,u,!1,n),_=c.length-1;_>=0;_--)t.splice(s,0,c[_]);s=s+c.length}o=0,h=0,f="",u="";break}s++}return t.pop(),t},l.prototype.diff_bisect_=function(e,r,n){for(var i=e.length,a=r.length,t=Math.ceil((i+a)/2),s=t,h=2*t,o=new Array(h),f=new Array(h),u=0;u<h;u++)o[u]=-1,f[u]=-1;o[s+1]=0,f[s+1]=0;for(var c=i-a,_=c%2!=0,b=0,p=0,M=0,k=0,d=0;d<t&&!(new Date().getTime()>n);d++){for(var D=-d+b;D<=d-p;D+=2){var y=s+D,A;D==-d||D!=d&&o[y-1]<o[y+1]?A=o[y+1]:A=o[y-1]+1;for(var E=A-D;A<i&&E<a&&e.charAt(A)==r.charAt(E);)A++,E++;if(o[y]=A,A>i)p+=2;else if(E>a)b+=2;else if(_){var S=s+c-D;if(S>=0&&S<h&&f[S]!=-1){var O=i-f[S];if(A>=O)return this.diff_bisectSplit_(e,r,A,E,n)}}}for(var I=-d+M;I<=d-k;I+=2){var S=s+I,O;I==-d||I!=d&&f[S-1]<f[S+1]?O=f[S+1]:O=f[S-1]+1;for(var T=O-I;O<i&&T<a&&e.charAt(i-O-1)==r.charAt(a-T-1);)O++,T++;if(f[S]=O,O>i)k+=2;else if(T>a)M+=2;else if(!_){var y=s+c-I;if(y>=0&&y<h&&o[y]!=-1){var A=o[y],E=s+A-y;if(O=i-O,A>=O)return this.diff_bisectSplit_(e,r,A,E,n)}}}}return[new l.Diff(m,e),new l.Diff(g,r)]},l.prototype.diff_bisectSplit_=function(e,r,n,i,a){var t=e.substring(0,n),s=r.substring(0,i),h=e.substring(n),o=r.substring(i),f=this.diff_main(t,s,!1,a),u=this.diff_main(h,o,!1,a);return f.concat(u)},l.prototype.diff_linesToChars_=function(e,r){var n=[],i={};n[0]="";function a(o){for(var f="",u=0,c=-1,_=n.length;c<o.length-1;){c=o.indexOf(`
`,u),c==-1&&(c=o.length-1);var b=o.substring(u,c+1);(i.hasOwnProperty?i.hasOwnProperty(b):i[b]!==void 0)?f+=String.fromCharCode(i[b]):(_==t&&(b=o.substring(u),c=o.length),f+=String.fromCharCode(_),i[b]=_,n[_++]=b),u=c+1}return f}var t=4e4,s=a(e);t=65535;var h=a(r);return{chars1:s,chars2:h,lineArray:n}},l.prototype.diff_charsToLines_=function(e,r){for(var n=0;n<e.length;n++){for(var i=e[n][1],a=[],t=0;t<i.length;t++)a[t]=r[i.charCodeAt(t)];e[n][1]=a.join("")}},l.prototype.diff_commonPrefix=function(e,r){if(!e||!r||e.charAt(0)!=r.charAt(0))return 0;for(var n=0,i=Math.min(e.length,r.length),a=i,t=0;n<a;)e.substring(t,a)==r.substring(t,a)?(n=a,t=n):i=a,a=Math.floor((i-n)/2+n);return a},l.prototype.diff_commonSuffix=function(e,r){if(!e||!r||e.charAt(e.length-1)!=r.charAt(r.length-1))return 0;for(var n=0,i=Math.min(e.length,r.length),a=i,t=0;n<a;)e.substring(e.length-a,e.length-t)==r.substring(r.length-a,r.length-t)?(n=a,t=n):i=a,a=Math.floor((i-n)/2+n);return a},l.prototype.diff_commonOverlap_=function(e,r){var n=e.length,i=r.length;if(n==0||i==0)return 0;n>i?e=e.substring(n-i):n<i&&(r=r.substring(0,n));var a=Math.min(n,i);if(e==r)return a;for(var t=0,s=1;;){var h=e.substring(a-s),o=r.indexOf(h);if(o==-1)return t;s+=o,(o==0||e.substring(a-s)==r.substring(0,s))&&(t=s,s++)}},l.prototype.diff_halfMatch_=function(e,r){if(this.Diff_Timeout<=0)return null;var n=e.length>r.length?e:r,i=e.length>r.length?r:e;if(n.length<4||i.length*2<n.length)return null;var a=this;function t(p,M,k){for(var d=p.substring(k,k+Math.floor(p.length/4)),D=-1,y="",A,E,S,O;(D=M.indexOf(d,D+1))!=-1;){var I=a.diff_commonPrefix(p.substring(k),M.substring(D)),T=a.diff_commonSuffix(p.substring(0,k),M.substring(0,D));y.length<T+I&&(y=M.substring(D-T,D)+M.substring(D,D+I),A=p.substring(0,k-T),E=p.substring(k+I),S=M.substring(0,D-T),O=M.substring(D+I))}return y.length*2>=p.length?[A,E,S,O,y]:null}var s=t(n,i,Math.ceil(n.length/4)),h=t(n,i,Math.ceil(n.length/2)),o;if(!s&&!h)return null;h?s?o=s[4].length>h[4].length?s:h:o=h:o=s;var f,u,c,_;e.length>r.length?(f=o[0],u=o[1],c=o[2],_=o[3]):(c=o[0],_=o[1],f=o[2],u=o[3]);var b=o[4];return[f,u,c,_,b]},l.prototype.diff_cleanupSemantic=function(e){for(var r=!1,n=[],i=0,a=null,t=0,s=0,h=0,o=0,f=0;t<e.length;)e[t][0]==v?(n[i++]=t,s=o,h=f,o=0,f=0,a=e[t][1]):(e[t][0]==g?o+=e[t][1].length:f+=e[t][1].length,a&&a.length<=Math.max(s,h)&&a.length<=Math.max(o,f)&&(e.splice(n[i-1],0,new l.Diff(m,a)),e[n[i-1]+1][0]=g,i--,i--,t=i>0?n[i-1]:-1,s=0,h=0,o=0,f=0,a=null,r=!0)),t++;for(r&&this.diff_cleanupMerge(e),this.diff_cleanupSemanticLossless(e),t=1;t<e.length;){if(e[t-1][0]==m&&e[t][0]==g){var u=e[t-1][1],c=e[t][1],_=this.diff_commonOverlap_(u,c),b=this.diff_commonOverlap_(c,u);_>=b?(_>=u.length/2||_>=c.length/2)&&(e.splice(t,0,new l.Diff(v,c.substring(0,_))),e[t-1][1]=u.substring(0,u.length-_),e[t+1][1]=c.substring(_),t++):(b>=u.length/2||b>=c.length/2)&&(e.splice(t,0,new l.Diff(v,u.substring(0,b))),e[t-1][0]=g,e[t-1][1]=c.substring(0,c.length-b),e[t+1][0]=m,e[t+1][1]=u.substring(b),t++),t++}t++}},l.prototype.diff_cleanupSemanticLossless=function(e){function r(b,p){if(!b||!p)return 6;var M=b.charAt(b.length-1),k=p.charAt(0),d=M.match(l.nonAlphaNumericRegex_),D=k.match(l.nonAlphaNumericRegex_),y=d&&M.match(l.whitespaceRegex_),A=D&&k.match(l.whitespaceRegex_),E=y&&M.match(l.linebreakRegex_),S=A&&k.match(l.linebreakRegex_),O=E&&b.match(l.blanklineEndRegex_),I=S&&p.match(l.blanklineStartRegex_);return O||I?5:E||S?4:d&&!y&&A?3:y||A?2:d||D?1:0}for(var n=1;n<e.length-1;){if(e[n-1][0]==v&&e[n+1][0]==v){var i=e[n-1][1],a=e[n][1],t=e[n+1][1],s=this.diff_commonSuffix(i,a);if(s){var h=a.substring(a.length-s);i=i.substring(0,i.length-s),a=h+a.substring(0,a.length-s),t=h+t}for(var o=i,f=a,u=t,c=r(i,a)+r(a,t);a.charAt(0)===t.charAt(0);){i+=a.charAt(0),a=a.substring(1)+t.charAt(0),t=t.substring(1);var _=r(i,a)+r(a,t);_>=c&&(c=_,o=i,f=a,u=t)}e[n-1][1]!=o&&(o?e[n-1][1]=o:(e.splice(n-1,1),n--),e[n][1]=f,u?e[n+1][1]=u:(e.splice(n+1,1),n--))}n++}},l.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,l.whitespaceRegex_=/\s/,l.linebreakRegex_=/[\r\n]/,l.blanklineEndRegex_=/\n\r?\n$/,l.blanklineStartRegex_=/^\r?\n\r?\n/,l.prototype.diff_cleanupEfficiency=function(e){for(var r=!1,n=[],i=0,a=null,t=0,s=!1,h=!1,o=!1,f=!1;t<e.length;)e[t][0]==v?(e[t][1].length<this.Diff_EditCost&&(o||f)?(n[i++]=t,s=o,h=f,a=e[t][1]):(i=0,a=null),o=f=!1):(e[t][0]==m?f=!0:o=!0,a&&(s&&h&&o&&f||a.length<this.Diff_EditCost/2&&s+h+o+f==3)&&(e.splice(n[i-1],0,new l.Diff(m,a)),e[n[i-1]+1][0]=g,i--,a=null,s&&h?(o=f=!0,i=0):(i--,t=i>0?n[i-1]:-1,o=f=!1),r=!0)),t++;r&&this.diff_cleanupMerge(e)},l.prototype.diff_cleanupMerge=function(e){e.push(new l.Diff(v,""));for(var r=0,n=0,i=0,a="",t="",s;r<e.length;)switch(e[r][0]){case g:i++,t+=e[r][1],r++;break;case m:n++,a+=e[r][1],r++;break;case v:n+i>1?(n!==0&&i!==0&&(s=this.diff_commonPrefix(t,a),s!==0&&(r-n-i>0&&e[r-n-i-1][0]==v?e[r-n-i-1][1]+=t.substring(0,s):(e.splice(0,0,new l.Diff(v,t.substring(0,s))),r++),t=t.substring(s),a=a.substring(s)),s=this.diff_commonSuffix(t,a),s!==0&&(e[r][1]=t.substring(t.length-s)+e[r][1],t=t.substring(0,t.length-s),a=a.substring(0,a.length-s))),r-=n+i,e.splice(r,n+i),a.length&&(e.splice(r,0,new l.Diff(m,a)),r++),t.length&&(e.splice(r,0,new l.Diff(g,t)),r++),r++):r!==0&&e[r-1][0]==v?(e[r-1][1]+=e[r][1],e.splice(r,1)):r++,i=0,n=0,a="",t="";break}e[e.length-1][1]===""&&e.pop();var h=!1;for(r=1;r<e.length-1;)e[r-1][0]==v&&e[r+1][0]==v&&(e[r][1].substring(e[r][1].length-e[r-1][1].length)==e[r-1][1]?(e[r][1]=e[r-1][1]+e[r][1].substring(0,e[r][1].length-e[r-1][1].length),e[r+1][1]=e[r-1][1]+e[r+1][1],e.splice(r-1,1),h=!0):e[r][1].substring(0,e[r+1][1].length)==e[r+1][1]&&(e[r-1][1]+=e[r+1][1],e[r][1]=e[r][1].substring(e[r+1][1].length)+e[r+1][1],e.splice(r+1,1),h=!0)),r++;h&&this.diff_cleanupMerge(e)},l.prototype.diff_xIndex=function(e,r){var n=0,i=0,a=0,t=0,s;for(s=0;s<e.length&&(e[s][0]!==g&&(n+=e[s][1].length),e[s][0]!==m&&(i+=e[s][1].length),!(n>r));s++)a=n,t=i;return e.length!=s&&e[s][0]===m?t:t+(r-a)},l.prototype.diff_prettyHtml=function(e){for(var r=[],n=/&/g,i=/</g,a=/>/g,t=/\n/g,s=0;s<e.length;s++){var h=e[s][0],o=e[s][1],f=o.replace(n,"&amp;").replace(i,"&lt;").replace(a,"&gt;").replace(t,"&para;<br>");switch(h){case g:r[s]='<ins style="background:#e6ffe6;">'+f+"</ins>";break;case m:r[s]='<del style="background:#ffe6e6;">'+f+"</del>";break;case v:r[s]="<span>"+f+"</span>";break}}return r.join("")},l.prototype.diff_text1=function(e){for(var r=[],n=0;n<e.length;n++)e[n][0]!==g&&(r[n]=e[n][1]);return r.join("")},l.prototype.diff_text2=function(e){for(var r=[],n=0;n<e.length;n++)e[n][0]!==m&&(r[n]=e[n][1]);return r.join("")},l.prototype.diff_levenshtein=function(e){for(var r=0,n=0,i=0,a=0;a<e.length;a++){var t=e[a][0],s=e[a][1];switch(t){case g:n+=s.length;break;case m:i+=s.length;break;case v:r+=Math.max(n,i),n=0,i=0;break}}return r+=Math.max(n,i),r},l.prototype.diff_toDelta=function(e){for(var r=[],n=0;n<e.length;n++)switch(e[n][0]){case g:r[n]="+"+encodeURI(e[n][1]);break;case m:r[n]="-"+e[n][1].length;break;case v:r[n]="="+e[n][1].length;break}return r.join("	").replace(/%20/g," ")},l.prototype.diff_fromDelta=function(e,r){for(var n=[],i=0,a=0,t=r.split(/\t/g),s=0;s<t.length;s++){var h=t[s].substring(1);switch(t[s].charAt(0)){case"+":try{n[i++]=new l.Diff(g,decodeURI(h))}catch{throw new Error("Illegal escape in diff_fromDelta: "+h)}break;case"-":case"=":var o=parseInt(h,10);if(isNaN(o)||o<0)throw new Error("Invalid number in diff_fromDelta: "+h);var f=e.substring(a,a+=o);t[s].charAt(0)=="="?n[i++]=new l.Diff(v,f):n[i++]=new l.Diff(m,f);break;default:if(t[s])throw new Error("Invalid diff operation in diff_fromDelta: "+t[s])}}if(a!=e.length)throw new Error("Delta length ("+a+") does not equal source text length ("+e.length+").");return n},l.prototype.match_main=function(e,r,n){if(e==null||r==null||n==null)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,e.length)),e==r?0:e.length?e.substring(n,n+r.length)==r?n:this.match_bitap_(e,r,n):-1},l.prototype.match_bitap_=function(e,r,n){if(r.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var i=this.match_alphabet_(r),a=this;function t(A,E){var S=A/r.length,O=Math.abs(n-E);return a.Match_Distance?S+O/a.Match_Distance:O?1:S}var s=this.Match_Threshold,h=e.indexOf(r,n);h!=-1&&(s=Math.min(t(0,h),s),h=e.lastIndexOf(r,n+r.length),h!=-1&&(s=Math.min(t(0,h),s)));var o=1<<r.length-1;h=-1;for(var f,u,c=r.length+e.length,_,b=0;b<r.length;b++){for(f=0,u=c;f<u;)t(b,n+u)<=s?f=u:c=u,u=Math.floor((c-f)/2+f);c=u;var p=Math.max(1,n-u+1),M=Math.min(n+u,e.length)+r.length,k=Array(M+2);k[M+1]=(1<<b)-1;for(var d=M;d>=p;d--){var D=i[e.charAt(d-1)];if(b===0?k[d]=(k[d+1]<<1|1)&D:k[d]=(k[d+1]<<1|1)&D|((_[d+1]|_[d])<<1|1)|_[d+1],k[d]&o){var y=t(b,d-1);if(y<=s)if(s=y,h=d-1,h>n)p=Math.max(1,2*n-h);else break}}if(t(b+1,n)>s)break;_=k}return h},l.prototype.match_alphabet_=function(e){for(var r={},n=0;n<e.length;n++)r[e.charAt(n)]=0;for(var n=0;n<e.length;n++)r[e.charAt(n)]|=1<<e.length-n-1;return r},l.prototype.patch_addContext_=function(e,r){if(r.length!=0){if(e.start2===null)throw Error("patch not initialized");for(var n=r.substring(e.start2,e.start2+e.length1),i=0;r.indexOf(n)!=r.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)i+=this.Patch_Margin,n=r.substring(e.start2-i,e.start2+e.length1+i);i+=this.Patch_Margin;var a=r.substring(e.start2-i,e.start2);a&&e.diffs.unshift(new l.Diff(v,a));var t=r.substring(e.start2+e.length1,e.start2+e.length1+i);t&&e.diffs.push(new l.Diff(v,t)),e.start1-=a.length,e.start2-=a.length,e.length1+=a.length+t.length,e.length2+=a.length+t.length}},l.prototype.patch_make=function(e,r,n){var i,a;if(typeof e=="string"&&typeof r=="string"&&typeof n>"u")i=e,a=this.diff_main(i,r,!0),a.length>2&&(this.diff_cleanupSemantic(a),this.diff_cleanupEfficiency(a));else if(e&&typeof e=="object"&&typeof r>"u"&&typeof n>"u")a=e,i=this.diff_text1(a);else if(typeof e=="string"&&r&&typeof r=="object"&&typeof n>"u")i=e,a=r;else if(typeof e=="string"&&typeof r=="string"&&n&&typeof n=="object")i=e,a=n;else throw new Error("Unknown call format to patch_make.");if(a.length===0)return[];for(var t=[],s=new l.patch_obj,h=0,o=0,f=0,u=i,c=i,_=0;_<a.length;_++){var b=a[_][0],p=a[_][1];switch(!h&&b!==v&&(s.start1=o,s.start2=f),b){case g:s.diffs[h++]=a[_],s.length2+=p.length,c=c.substring(0,f)+p+c.substring(f);break;case m:s.length1+=p.length,s.diffs[h++]=a[_],c=c.substring(0,f)+c.substring(f+p.length);break;case v:p.length<=2*this.Patch_Margin&&h&&a.length!=_+1?(s.diffs[h++]=a[_],s.length1+=p.length,s.length2+=p.length):p.length>=2*this.Patch_Margin&&h&&(this.patch_addContext_(s,u),t.push(s),s=new l.patch_obj,h=0,u=c,o=f);break}b!==g&&(o+=p.length),b!==m&&(f+=p.length)}return h&&(this.patch_addContext_(s,u),t.push(s)),t},l.prototype.patch_deepCopy=function(e){for(var r=[],n=0;n<e.length;n++){var i=e[n],a=new l.patch_obj;a.diffs=[];for(var t=0;t<i.diffs.length;t++)a.diffs[t]=new l.Diff(i.diffs[t][0],i.diffs[t][1]);a.start1=i.start1,a.start2=i.start2,a.length1=i.length1,a.length2=i.length2,r[n]=a}return r},l.prototype.patch_apply=function(e,r){if(e.length==0)return[r,[]];e=this.patch_deepCopy(e);var n=this.patch_addPadding(e);r=n+r+n,this.patch_splitMax(e);for(var i=0,a=[],t=0;t<e.length;t++){var s=e[t].start2+i,h=this.diff_text1(e[t].diffs),o,f=-1;if(h.length>this.Match_MaxBits?(o=this.match_main(r,h.substring(0,this.Match_MaxBits),s),o!=-1&&(f=this.match_main(r,h.substring(h.length-this.Match_MaxBits),s+h.length-this.Match_MaxBits),(f==-1||o>=f)&&(o=-1))):o=this.match_main(r,h,s),o==-1)a[t]=!1,i-=e[t].length2-e[t].length1;else{a[t]=!0,i=o-s;var u;if(f==-1?u=r.substring(o,o+h.length):u=r.substring(o,f+this.Match_MaxBits),h==u)r=r.substring(0,o)+this.diff_text2(e[t].diffs)+r.substring(o+h.length);else{var c=this.diff_main(h,u,!1);if(h.length>this.Match_MaxBits&&this.diff_levenshtein(c)/h.length>this.Patch_DeleteThreshold)a[t]=!1;else{this.diff_cleanupSemanticLossless(c);for(var _=0,b,p=0;p<e[t].diffs.length;p++){var M=e[t].diffs[p];M[0]!==v&&(b=this.diff_xIndex(c,_)),M[0]===g?r=r.substring(0,o+b)+M[1]+r.substring(o+b):M[0]===m&&(r=r.substring(0,o+b)+r.substring(o+this.diff_xIndex(c,_+M[1].length))),M[0]!==m&&(_+=M[1].length)}}}}}return r=r.substring(n.length,r.length-n.length),[r,a]},l.prototype.patch_addPadding=function(e){for(var r=this.Patch_Margin,n="",i=1;i<=r;i++)n+=String.fromCharCode(i);for(var i=0;i<e.length;i++)e[i].start1+=r,e[i].start2+=r;var a=e[0],t=a.diffs;if(t.length==0||t[0][0]!=v)t.unshift(new l.Diff(v,n)),a.start1-=r,a.start2-=r,a.length1+=r,a.length2+=r;else if(r>t[0][1].length){var s=r-t[0][1].length;t[0][1]=n.substring(t[0][1].length)+t[0][1],a.start1-=s,a.start2-=s,a.length1+=s,a.length2+=s}if(a=e[e.length-1],t=a.diffs,t.length==0||t[t.length-1][0]!=v)t.push(new l.Diff(v,n)),a.length1+=r,a.length2+=r;else if(r>t[t.length-1][1].length){var s=r-t[t.length-1][1].length;t[t.length-1][1]+=n.substring(0,s),a.length1+=s,a.length2+=s}return n},l.prototype.patch_splitMax=function(e){for(var r=this.Match_MaxBits,n=0;n<e.length;n++)if(!(e[n].length1<=r)){var i=e[n];e.splice(n--,1);for(var a=i.start1,t=i.start2,s="";i.diffs.length!==0;){var h=new l.patch_obj,o=!0;for(h.start1=a-s.length,h.start2=t-s.length,s!==""&&(h.length1=h.length2=s.length,h.diffs.push(new l.Diff(v,s)));i.diffs.length!==0&&h.length1<r-this.Patch_Margin;){var f=i.diffs[0][0],u=i.diffs[0][1];f===g?(h.length2+=u.length,t+=u.length,h.diffs.push(i.diffs.shift()),o=!1):f===m&&h.diffs.length==1&&h.diffs[0][0]==v&&u.length>2*r?(h.length1+=u.length,a+=u.length,o=!1,h.diffs.push(new l.Diff(f,u)),i.diffs.shift()):(u=u.substring(0,r-h.length1-this.Patch_Margin),h.length1+=u.length,a+=u.length,f===v?(h.length2+=u.length,t+=u.length):o=!1,h.diffs.push(new l.Diff(f,u)),u==i.diffs[0][1]?i.diffs.shift():i.diffs[0][1]=i.diffs[0][1].substring(u.length))}s=this.diff_text2(h.diffs),s=s.substring(s.length-this.Patch_Margin);var c=this.diff_text1(i.diffs).substring(0,this.Patch_Margin);c!==""&&(h.length1+=c.length,h.length2+=c.length,h.diffs.length!==0&&h.diffs[h.diffs.length-1][0]===v?h.diffs[h.diffs.length-1][1]+=c:h.diffs.push(new l.Diff(v,c))),o||e.splice(++n,0,h)}}},l.prototype.patch_toText=function(e){for(var r=[],n=0;n<e.length;n++)r[n]=e[n];return r.join("")},l.prototype.patch_fromText=function(e){var r=[];if(!e)return r;for(var n=e.split(`
`),i=0,a=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;i<n.length;){var t=n[i].match(a);if(!t)throw new Error("Invalid patch string: "+n[i]);var s=new l.patch_obj;for(r.push(s),s.start1=parseInt(t[1],10),t[2]===""?(s.start1--,s.length1=1):t[2]=="0"?s.length1=0:(s.start1--,s.length1=parseInt(t[2],10)),s.start2=parseInt(t[3],10),t[4]===""?(s.start2--,s.length2=1):t[4]=="0"?s.length2=0:(s.start2--,s.length2=parseInt(t[4],10)),i++;i<n.length;){var h=n[i].charAt(0);try{var o=decodeURI(n[i].substring(1))}catch{throw new Error("Illegal escape in patch_fromText: "+o)}if(h=="-")s.diffs.push(new l.Diff(m,o));else if(h=="+")s.diffs.push(new l.Diff(g,o));else if(h==" ")s.diffs.push(new l.Diff(v,o));else{if(h=="@")break;if(h!=="")throw new Error('Invalid patch mode "'+h+'" in: '+o)}i++}}return r},l.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},l.patch_obj.prototype.toString=function(){var e,r;this.length1===0?e=this.start1+",0":this.length1==1?e=this.start1+1:e=this.start1+1+","+this.length1,this.length2===0?r=this.start2+",0":this.length2==1?r=this.start2+1:r=this.start2+1+","+this.length2;for(var n=["@@ -"+e+" +"+r+` @@
`],i,a=0;a<this.diffs.length;a++){switch(this.diffs[a][0]){case g:i="+";break;case m:i="-";break;case v:i=" ";break}n[a+1]=i+encodeURI(this.diffs[a][1])+`
`}return n.join("").replace(/%20/g," ")},w.exports=l,w.exports.diff_match_patch=l,w.exports.DIFF_DELETE=m,w.exports.DIFF_INSERT=g,w.exports.DIFF_EQUAL=v})(R)),R.exports}var z=U();const $=`You are a grammar checker. Find ONLY grammar and spelling errors in the text.

CRITICAL RULES:
1. ONLY fix actual grammar mistakes (subject-verb agreement, tense errors, article usage, etc.)
2. ONLY fix spelling mistakes
3. DO NOT rewrite sentences for "clarity" or "style"
4. DO NOT change the meaning or structure of sentences
5. The "suggestion" must be minimal - change ONLY the specific word(s) with errors
6. If a sentence is grammatically correct, DO NOT suggest changes
7. NEVER suggest capitalizing letters WITHIN words - only standalone "i" (the pronoun) should be "I"
8. DO NOT flag individual letters or parts of words - only flag complete words or phrases
9. The lowercase "i" is ONLY wrong when it stands ALONE as the pronoun (e.g., "i think" → "I think")
10. Letters like "i" inside words (like "in", "it", "is", "like", "this") are CORRECT and must NOT be flagged

IMPORTANT GRAMMAR RULES TO FOLLOW:
- After "doesn't", "don't", "does", "do", "didn't", "can't", "won't", "shouldn't", "couldn't", "wouldn't" → use BASE VERB (no -s/-es)
  Example: "doesn't work" is CORRECT, "doesn't works" is WRONG
- After "he/she/it" without auxiliary → use VERB+S
  Example: "it works" is CORRECT, "it work" is WRONG
- "its" = possessive, "it's" = "it is"
- Standalone "i" (pronoun) → should be "I" (capitalized)
  Example: "i think" is WRONG → "I think" is CORRECT
  But "in", "it", "is" are CORRECT as-is

Respond ONLY with a JSON object. No markdown.

JSON Structure:
{
  "corrections": [
    {
      "type": "grammar" | "spelling",
      "original": "exact erroneous word or phrase",
      "suggestion": "corrected word or phrase", 
      "explanation": "brief reason",
      "start": number,
      "end": number,
      "severity": "error" | "warning"
    }
  ],
  "overallScore": 0-100,
  "stats": { "wordCount": number, "readabilityScore": 0-10 }
}

Examples:
- "sometimes it work" → "it work" should be "it works" (subject-verb agreement)
- "doesn't works" → "works" should be "work" (base verb after doesn't)
- "recieve" → "receive" (spelling)
- "a apple" → "an apple" (article)
- "its raining" → "its" should be "it's" (contraction)

DO NOT create correction loops. Analyze the FULL context before suggesting.`,N=new Map,Y=1e3*60*5,C=3e3;async function j(w,l){if(w.length<=C)return L(w,l);const m=G(w,C),g=await Promise.all(m.map(n=>L(n.text,l))),v={corrections:[],overallScore:0,stats:{wordCount:0,readabilityScore:0}};let e=0,r=0;return g.forEach((n,i)=>{const a=m[i].offset;n.corrections.forEach(t=>{t.start+=a,t.end+=a}),v.corrections.push(...n.corrections),v.stats.wordCount+=n.stats.wordCount,e+=n.overallScore,r+=n.stats.readabilityScore}),v.overallScore=Math.round(e/g.length),v.stats.readabilityScore=Number((r/g.length).toFixed(1)),v}async function L(w,l){const m=`${l.selectedModel}:${l.mode}:${l.aggressiveness}:${w}`,g=N.get(m);if(g&&Date.now()-g.timestamp<Y)return g.response;if(!l.openRouterKey)throw new Error("OpenRouter API key is missing");const v=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${l.openRouterKey}`,"Content-Type":"application/json","HTTP-Referer":"https://github.com/open-grammarly","X-Title":"Open Grammarly"},body:JSON.stringify({model:l.selectedModel,messages:[{role:"system",content:`${$}
Writing Mode: ${l.mode}
Aggressiveness: ${l.aggressiveness}`},{role:"user",content:w}],response_format:{type:"json_object"},temperature:.3})});if(!v.ok){const n=await v.json().catch(()=>({}));throw new Error(n.error?.message||`API request failed with status ${v.status}`)}const r=(await v.json()).choices[0].message.content;try{const n=JSON.parse(r),i=H(w,n);return N.set(m,{response:i,timestamp:Date.now()}),i}catch{throw new Error("Invalid response format from AI.")}}function G(w,l){const m=[];let g=0;for(;g<w.length;){let v=g+l;if(v<w.length){const e=w.lastIndexOf(`
`,v);if(e>g+l*.5)v=e+1;else{const r=w.lastIndexOf(". ",v);r>g+l*.5&&(v=r+2)}}else v=w.length;m.push({text:w.substring(g,v),offset:g}),g=v}return m}function H(w,l){const m=new z.diff_match_patch;return l.corrections=l.corrections.filter(g=>{if(g.original.length===1&&g.suggestion.length===1)if(g.original==="i"&&g.suggestion==="I"){const n=g.start>0?w[g.start-1]:" ",i=g.end<w.length?w[g.end]:" ";if(!(/[\s.,!?;:'"()\[\]{}\-]/.test(n)&&/[\s.,!?;:'"()\[\]{}\-]/.test(i)))return!1}else return!1;if(g.original.toLowerCase()===g.suggestion.toLowerCase()&&g.original!==g.suggestion&&g.original.length>1){let n=0;for(let i=0;i<g.original.length;i++)g.original[i]!==g.suggestion[i]&&n++;if(n===1&&g.original.toLowerCase()===g.suggestion.toLowerCase())return!1}if(w.substring(g.start,g.end)===g.original)return!0;const e=w.indexOf(g.original);if(e!==-1)return g.start=e,g.end=e+g.original.length,!0;const r=m.match_main(w,g.original,g.start);return r!==-1?(g.start=r,g.end=r+g.original.length,g.original=w.substring(g.start,g.end),!0):!1}),l}chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:"analyzeSelection",title:"Analyze with Open Grammarly",contexts:["selection"]})});chrome.contextMenus.onClicked.addListener(async(w,l)=>{if(w.menuItemId==="analyzeSelection"&&w.selectionText&&l?.id)try{const m=await B(w.selectionText);chrome.tabs.sendMessage(l.id,{type:"SHOW_ANALYSIS_RESULTS",data:m})}catch{}});chrome.runtime.onMessage.addListener((w,l,m)=>{if(w.type==="PING"){m({success:!0,message:"PONG"});return}if(w.type==="OPEN_OPTIONS"){chrome.runtime.openOptionsPage(),m({success:!0});return}if(w.type==="ANALYZE_TEXT")return B(w.text).then(g=>{m(g)}),!0});async function B(w){try{const l=await F();return l.openRouterKey?l.enabled?{success:!0,data:await j(w,l)}:{success:!1,error:"Extension is disabled"}:{success:!1,error:"API key not set. Please open extension options and enter your OpenRouter key."}}catch(l){return{success:!1,error:l.message}}}
