import{g as B}from"./storage-hRoG6Hut.js";var T={exports:{}},R;function U(){return R||(R=1,(function(w){var h=function(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32},m=-1,c=1,u=0;h.Diff=function(r,e){return[r,e]},h.prototype.diff_main=function(r,e,n,a){typeof a>"u"&&(this.Diff_Timeout<=0?a=Number.MAX_VALUE:a=new Date().getTime()+this.Diff_Timeout*1e3);var i=a;if(r==null||e==null)throw new Error("Null input. (diff_main)");if(r==e)return r?[new h.Diff(u,r)]:[];typeof n>"u"&&(n=!0);var t=n,s=this.diff_commonPrefix(r,e),l=r.substring(0,s);r=r.substring(s),e=e.substring(s),s=this.diff_commonSuffix(r,e);var o=r.substring(r.length-s);r=r.substring(0,r.length-s),e=e.substring(0,e.length-s);var f=this.diff_compute_(r,e,t,i);return l&&f.unshift(new h.Diff(u,l)),o&&f.push(new h.Diff(u,o)),this.diff_cleanupMerge(f),f},h.prototype.diff_compute_=function(r,e,n,a){var i;if(!r)return[new h.Diff(c,e)];if(!e)return[new h.Diff(m,r)];var t=r.length>e.length?r:e,s=r.length>e.length?e:r,l=t.indexOf(s);if(l!=-1)return i=[new h.Diff(c,t.substring(0,l)),new h.Diff(u,s),new h.Diff(c,t.substring(l+s.length))],r.length>e.length&&(i[0][0]=i[2][0]=m),i;if(s.length==1)return[new h.Diff(m,r),new h.Diff(c,e)];var o=this.diff_halfMatch_(r,e);if(o){var f=o[0],g=o[1],v=o[2],_=o[3],b=o[4],p=this.diff_main(f,v,n,a),M=this.diff_main(g,_,n,a);return p.concat([new h.Diff(u,b)],M)}return n&&r.length>100&&e.length>100?this.diff_lineMode_(r,e,a):this.diff_bisect_(r,e,a)},h.prototype.diff_lineMode_=function(r,e,n){var a=this.diff_linesToChars_(r,e);r=a.chars1,e=a.chars2;var i=a.lineArray,t=this.diff_main(r,e,!1,n);this.diff_charsToLines_(t,i),this.diff_cleanupSemantic(t),t.push(new h.Diff(u,""));for(var s=0,l=0,o=0,f="",g="";s<t.length;){switch(t[s][0]){case c:o++,g+=t[s][1];break;case m:l++,f+=t[s][1];break;case u:if(l>=1&&o>=1){t.splice(s-l-o,l+o),s=s-l-o;for(var v=this.diff_main(f,g,!1,n),_=v.length-1;_>=0;_--)t.splice(s,0,v[_]);s=s+v.length}o=0,l=0,f="",g="";break}s++}return t.pop(),t},h.prototype.diff_bisect_=function(r,e,n){for(var a=r.length,i=e.length,t=Math.ceil((a+i)/2),s=t,l=2*t,o=new Array(l),f=new Array(l),g=0;g<l;g++)o[g]=-1,f[g]=-1;o[s+1]=0,f[s+1]=0;for(var v=a-i,_=v%2!=0,b=0,p=0,M=0,S=0,d=0;d<t&&!(new Date().getTime()>n);d++){for(var D=-d+b;D<=d-p;D+=2){var y=s+D,A;D==-d||D!=d&&o[y-1]<o[y+1]?A=o[y+1]:A=o[y-1]+1;for(var I=A-D;A<a&&I<i&&r.charAt(A)==e.charAt(I);)A++,I++;if(o[y]=A,A>a)p+=2;else if(I>i)b+=2;else if(_){var E=s+v-D;if(E>=0&&E<l&&f[E]!=-1){var k=a-f[E];if(A>=k)return this.diff_bisectSplit_(r,e,A,I,n)}}}for(var O=-d+M;O<=d-S;O+=2){var E=s+O,k;O==-d||O!=d&&f[E-1]<f[E+1]?k=f[E+1]:k=f[E-1]+1;for(var P=k-O;k<a&&P<i&&r.charAt(a-k-1)==e.charAt(i-P-1);)k++,P++;if(f[E]=k,k>a)S+=2;else if(P>i)M+=2;else if(!_){var y=s+v-O;if(y>=0&&y<l&&o[y]!=-1){var A=o[y],I=s+A-y;if(k=a-k,A>=k)return this.diff_bisectSplit_(r,e,A,I,n)}}}}return[new h.Diff(m,r),new h.Diff(c,e)]},h.prototype.diff_bisectSplit_=function(r,e,n,a,i){var t=r.substring(0,n),s=e.substring(0,a),l=r.substring(n),o=e.substring(a),f=this.diff_main(t,s,!1,i),g=this.diff_main(l,o,!1,i);return f.concat(g)},h.prototype.diff_linesToChars_=function(r,e){var n=[],a={};n[0]="";function i(o){for(var f="",g=0,v=-1,_=n.length;v<o.length-1;){v=o.indexOf(`
`,g),v==-1&&(v=o.length-1);var b=o.substring(g,v+1);(a.hasOwnProperty?a.hasOwnProperty(b):a[b]!==void 0)?f+=String.fromCharCode(a[b]):(_==t&&(b=o.substring(g),v=o.length),f+=String.fromCharCode(_),a[b]=_,n[_++]=b),g=v+1}return f}var t=4e4,s=i(r);t=65535;var l=i(e);return{chars1:s,chars2:l,lineArray:n}},h.prototype.diff_charsToLines_=function(r,e){for(var n=0;n<r.length;n++){for(var a=r[n][1],i=[],t=0;t<a.length;t++)i[t]=e[a.charCodeAt(t)];r[n][1]=i.join("")}},h.prototype.diff_commonPrefix=function(r,e){if(!r||!e||r.charAt(0)!=e.charAt(0))return 0;for(var n=0,a=Math.min(r.length,e.length),i=a,t=0;n<i;)r.substring(t,i)==e.substring(t,i)?(n=i,t=n):a=i,i=Math.floor((a-n)/2+n);return i},h.prototype.diff_commonSuffix=function(r,e){if(!r||!e||r.charAt(r.length-1)!=e.charAt(e.length-1))return 0;for(var n=0,a=Math.min(r.length,e.length),i=a,t=0;n<i;)r.substring(r.length-i,r.length-t)==e.substring(e.length-i,e.length-t)?(n=i,t=n):a=i,i=Math.floor((a-n)/2+n);return i},h.prototype.diff_commonOverlap_=function(r,e){var n=r.length,a=e.length;if(n==0||a==0)return 0;n>a?r=r.substring(n-a):n<a&&(e=e.substring(0,n));var i=Math.min(n,a);if(r==e)return i;for(var t=0,s=1;;){var l=r.substring(i-s),o=e.indexOf(l);if(o==-1)return t;s+=o,(o==0||r.substring(i-s)==e.substring(0,s))&&(t=s,s++)}},h.prototype.diff_halfMatch_=function(r,e){if(this.Diff_Timeout<=0)return null;var n=r.length>e.length?r:e,a=r.length>e.length?e:r;if(n.length<4||a.length*2<n.length)return null;var i=this;function t(p,M,S){for(var d=p.substring(S,S+Math.floor(p.length/4)),D=-1,y="",A,I,E,k;(D=M.indexOf(d,D+1))!=-1;){var O=i.diff_commonPrefix(p.substring(S),M.substring(D)),P=i.diff_commonSuffix(p.substring(0,S),M.substring(0,D));y.length<P+O&&(y=M.substring(D-P,D)+M.substring(D,D+O),A=p.substring(0,S-P),I=p.substring(S+O),E=M.substring(0,D-P),k=M.substring(D+O))}return y.length*2>=p.length?[A,I,E,k,y]:null}var s=t(n,a,Math.ceil(n.length/4)),l=t(n,a,Math.ceil(n.length/2)),o;if(!s&&!l)return null;l?s?o=s[4].length>l[4].length?s:l:o=l:o=s;var f,g,v,_;r.length>e.length?(f=o[0],g=o[1],v=o[2],_=o[3]):(v=o[0],_=o[1],f=o[2],g=o[3]);var b=o[4];return[f,g,v,_,b]},h.prototype.diff_cleanupSemantic=function(r){for(var e=!1,n=[],a=0,i=null,t=0,s=0,l=0,o=0,f=0;t<r.length;)r[t][0]==u?(n[a++]=t,s=o,l=f,o=0,f=0,i=r[t][1]):(r[t][0]==c?o+=r[t][1].length:f+=r[t][1].length,i&&i.length<=Math.max(s,l)&&i.length<=Math.max(o,f)&&(r.splice(n[a-1],0,new h.Diff(m,i)),r[n[a-1]+1][0]=c,a--,a--,t=a>0?n[a-1]:-1,s=0,l=0,o=0,f=0,i=null,e=!0)),t++;for(e&&this.diff_cleanupMerge(r),this.diff_cleanupSemanticLossless(r),t=1;t<r.length;){if(r[t-1][0]==m&&r[t][0]==c){var g=r[t-1][1],v=r[t][1],_=this.diff_commonOverlap_(g,v),b=this.diff_commonOverlap_(v,g);_>=b?(_>=g.length/2||_>=v.length/2)&&(r.splice(t,0,new h.Diff(u,v.substring(0,_))),r[t-1][1]=g.substring(0,g.length-_),r[t+1][1]=v.substring(_),t++):(b>=g.length/2||b>=v.length/2)&&(r.splice(t,0,new h.Diff(u,g.substring(0,b))),r[t-1][0]=c,r[t-1][1]=v.substring(0,v.length-b),r[t+1][0]=m,r[t+1][1]=g.substring(b),t++),t++}t++}},h.prototype.diff_cleanupSemanticLossless=function(r){function e(b,p){if(!b||!p)return 6;var M=b.charAt(b.length-1),S=p.charAt(0),d=M.match(h.nonAlphaNumericRegex_),D=S.match(h.nonAlphaNumericRegex_),y=d&&M.match(h.whitespaceRegex_),A=D&&S.match(h.whitespaceRegex_),I=y&&M.match(h.linebreakRegex_),E=A&&S.match(h.linebreakRegex_),k=I&&b.match(h.blanklineEndRegex_),O=E&&p.match(h.blanklineStartRegex_);return k||O?5:I||E?4:d&&!y&&A?3:y||A?2:d||D?1:0}for(var n=1;n<r.length-1;){if(r[n-1][0]==u&&r[n+1][0]==u){var a=r[n-1][1],i=r[n][1],t=r[n+1][1],s=this.diff_commonSuffix(a,i);if(s){var l=i.substring(i.length-s);a=a.substring(0,a.length-s),i=l+i.substring(0,i.length-s),t=l+t}for(var o=a,f=i,g=t,v=e(a,i)+e(i,t);i.charAt(0)===t.charAt(0);){a+=i.charAt(0),i=i.substring(1)+t.charAt(0),t=t.substring(1);var _=e(a,i)+e(i,t);_>=v&&(v=_,o=a,f=i,g=t)}r[n-1][1]!=o&&(o?r[n-1][1]=o:(r.splice(n-1,1),n--),r[n][1]=f,g?r[n+1][1]=g:(r.splice(n+1,1),n--))}n++}},h.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,h.whitespaceRegex_=/\s/,h.linebreakRegex_=/[\r\n]/,h.blanklineEndRegex_=/\n\r?\n$/,h.blanklineStartRegex_=/^\r?\n\r?\n/,h.prototype.diff_cleanupEfficiency=function(r){for(var e=!1,n=[],a=0,i=null,t=0,s=!1,l=!1,o=!1,f=!1;t<r.length;)r[t][0]==u?(r[t][1].length<this.Diff_EditCost&&(o||f)?(n[a++]=t,s=o,l=f,i=r[t][1]):(a=0,i=null),o=f=!1):(r[t][0]==m?f=!0:o=!0,i&&(s&&l&&o&&f||i.length<this.Diff_EditCost/2&&s+l+o+f==3)&&(r.splice(n[a-1],0,new h.Diff(m,i)),r[n[a-1]+1][0]=c,a--,i=null,s&&l?(o=f=!0,a=0):(a--,t=a>0?n[a-1]:-1,o=f=!1),e=!0)),t++;e&&this.diff_cleanupMerge(r)},h.prototype.diff_cleanupMerge=function(r){r.push(new h.Diff(u,""));for(var e=0,n=0,a=0,i="",t="",s;e<r.length;)switch(r[e][0]){case c:a++,t+=r[e][1],e++;break;case m:n++,i+=r[e][1],e++;break;case u:n+a>1?(n!==0&&a!==0&&(s=this.diff_commonPrefix(t,i),s!==0&&(e-n-a>0&&r[e-n-a-1][0]==u?r[e-n-a-1][1]+=t.substring(0,s):(r.splice(0,0,new h.Diff(u,t.substring(0,s))),e++),t=t.substring(s),i=i.substring(s)),s=this.diff_commonSuffix(t,i),s!==0&&(r[e][1]=t.substring(t.length-s)+r[e][1],t=t.substring(0,t.length-s),i=i.substring(0,i.length-s))),e-=n+a,r.splice(e,n+a),i.length&&(r.splice(e,0,new h.Diff(m,i)),e++),t.length&&(r.splice(e,0,new h.Diff(c,t)),e++),e++):e!==0&&r[e-1][0]==u?(r[e-1][1]+=r[e][1],r.splice(e,1)):e++,a=0,n=0,i="",t="";break}r[r.length-1][1]===""&&r.pop();var l=!1;for(e=1;e<r.length-1;)r[e-1][0]==u&&r[e+1][0]==u&&(r[e][1].substring(r[e][1].length-r[e-1][1].length)==r[e-1][1]?(r[e][1]=r[e-1][1]+r[e][1].substring(0,r[e][1].length-r[e-1][1].length),r[e+1][1]=r[e-1][1]+r[e+1][1],r.splice(e-1,1),l=!0):r[e][1].substring(0,r[e+1][1].length)==r[e+1][1]&&(r[e-1][1]+=r[e+1][1],r[e][1]=r[e][1].substring(r[e+1][1].length)+r[e+1][1],r.splice(e+1,1),l=!0)),e++;l&&this.diff_cleanupMerge(r)},h.prototype.diff_xIndex=function(r,e){var n=0,a=0,i=0,t=0,s;for(s=0;s<r.length&&(r[s][0]!==c&&(n+=r[s][1].length),r[s][0]!==m&&(a+=r[s][1].length),!(n>e));s++)i=n,t=a;return r.length!=s&&r[s][0]===m?t:t+(e-i)},h.prototype.diff_prettyHtml=function(r){for(var e=[],n=/&/g,a=/</g,i=/>/g,t=/\n/g,s=0;s<r.length;s++){var l=r[s][0],o=r[s][1],f=o.replace(n,"&amp;").replace(a,"&lt;").replace(i,"&gt;").replace(t,"&para;<br>");switch(l){case c:e[s]='<ins style="background:#e6ffe6;">'+f+"</ins>";break;case m:e[s]='<del style="background:#ffe6e6;">'+f+"</del>";break;case u:e[s]="<span>"+f+"</span>";break}}return e.join("")},h.prototype.diff_text1=function(r){for(var e=[],n=0;n<r.length;n++)r[n][0]!==c&&(e[n]=r[n][1]);return e.join("")},h.prototype.diff_text2=function(r){for(var e=[],n=0;n<r.length;n++)r[n][0]!==m&&(e[n]=r[n][1]);return e.join("")},h.prototype.diff_levenshtein=function(r){for(var e=0,n=0,a=0,i=0;i<r.length;i++){var t=r[i][0],s=r[i][1];switch(t){case c:n+=s.length;break;case m:a+=s.length;break;case u:e+=Math.max(n,a),n=0,a=0;break}}return e+=Math.max(n,a),e},h.prototype.diff_toDelta=function(r){for(var e=[],n=0;n<r.length;n++)switch(r[n][0]){case c:e[n]="+"+encodeURI(r[n][1]);break;case m:e[n]="-"+r[n][1].length;break;case u:e[n]="="+r[n][1].length;break}return e.join("	").replace(/%20/g," ")},h.prototype.diff_fromDelta=function(r,e){for(var n=[],a=0,i=0,t=e.split(/\t/g),s=0;s<t.length;s++){var l=t[s].substring(1);switch(t[s].charAt(0)){case"+":try{n[a++]=new h.Diff(c,decodeURI(l))}catch{throw new Error("Illegal escape in diff_fromDelta: "+l)}break;case"-":case"=":var o=parseInt(l,10);if(isNaN(o)||o<0)throw new Error("Invalid number in diff_fromDelta: "+l);var f=r.substring(i,i+=o);t[s].charAt(0)=="="?n[a++]=new h.Diff(u,f):n[a++]=new h.Diff(m,f);break;default:if(t[s])throw new Error("Invalid diff operation in diff_fromDelta: "+t[s])}}if(i!=r.length)throw new Error("Delta length ("+i+") does not equal source text length ("+r.length+").");return n},h.prototype.match_main=function(r,e,n){if(r==null||e==null||n==null)throw new Error("Null input. (match_main)");return n=Math.max(0,Math.min(n,r.length)),r==e?0:r.length?r.substring(n,n+e.length)==e?n:this.match_bitap_(r,e,n):-1},h.prototype.match_bitap_=function(r,e,n){if(e.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var a=this.match_alphabet_(e),i=this;function t(A,I){var E=A/e.length,k=Math.abs(n-I);return i.Match_Distance?E+k/i.Match_Distance:k?1:E}var s=this.Match_Threshold,l=r.indexOf(e,n);l!=-1&&(s=Math.min(t(0,l),s),l=r.lastIndexOf(e,n+e.length),l!=-1&&(s=Math.min(t(0,l),s)));var o=1<<e.length-1;l=-1;for(var f,g,v=e.length+r.length,_,b=0;b<e.length;b++){for(f=0,g=v;f<g;)t(b,n+g)<=s?f=g:v=g,g=Math.floor((v-f)/2+f);v=g;var p=Math.max(1,n-g+1),M=Math.min(n+g,r.length)+e.length,S=Array(M+2);S[M+1]=(1<<b)-1;for(var d=M;d>=p;d--){var D=a[r.charAt(d-1)];if(b===0?S[d]=(S[d+1]<<1|1)&D:S[d]=(S[d+1]<<1|1)&D|((_[d+1]|_[d])<<1|1)|_[d+1],S[d]&o){var y=t(b,d-1);if(y<=s)if(s=y,l=d-1,l>n)p=Math.max(1,2*n-l);else break}}if(t(b+1,n)>s)break;_=S}return l},h.prototype.match_alphabet_=function(r){for(var e={},n=0;n<r.length;n++)e[r.charAt(n)]=0;for(var n=0;n<r.length;n++)e[r.charAt(n)]|=1<<r.length-n-1;return e},h.prototype.patch_addContext_=function(r,e){if(e.length!=0){if(r.start2===null)throw Error("patch not initialized");for(var n=e.substring(r.start2,r.start2+r.length1),a=0;e.indexOf(n)!=e.lastIndexOf(n)&&n.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)a+=this.Patch_Margin,n=e.substring(r.start2-a,r.start2+r.length1+a);a+=this.Patch_Margin;var i=e.substring(r.start2-a,r.start2);i&&r.diffs.unshift(new h.Diff(u,i));var t=e.substring(r.start2+r.length1,r.start2+r.length1+a);t&&r.diffs.push(new h.Diff(u,t)),r.start1-=i.length,r.start2-=i.length,r.length1+=i.length+t.length,r.length2+=i.length+t.length}},h.prototype.patch_make=function(r,e,n){var a,i;if(typeof r=="string"&&typeof e=="string"&&typeof n>"u")a=r,i=this.diff_main(a,e,!0),i.length>2&&(this.diff_cleanupSemantic(i),this.diff_cleanupEfficiency(i));else if(r&&typeof r=="object"&&typeof e>"u"&&typeof n>"u")i=r,a=this.diff_text1(i);else if(typeof r=="string"&&e&&typeof e=="object"&&typeof n>"u")a=r,i=e;else if(typeof r=="string"&&typeof e=="string"&&n&&typeof n=="object")a=r,i=n;else throw new Error("Unknown call format to patch_make.");if(i.length===0)return[];for(var t=[],s=new h.patch_obj,l=0,o=0,f=0,g=a,v=a,_=0;_<i.length;_++){var b=i[_][0],p=i[_][1];switch(!l&&b!==u&&(s.start1=o,s.start2=f),b){case c:s.diffs[l++]=i[_],s.length2+=p.length,v=v.substring(0,f)+p+v.substring(f);break;case m:s.length1+=p.length,s.diffs[l++]=i[_],v=v.substring(0,f)+v.substring(f+p.length);break;case u:p.length<=2*this.Patch_Margin&&l&&i.length!=_+1?(s.diffs[l++]=i[_],s.length1+=p.length,s.length2+=p.length):p.length>=2*this.Patch_Margin&&l&&(this.patch_addContext_(s,g),t.push(s),s=new h.patch_obj,l=0,g=v,o=f);break}b!==c&&(o+=p.length),b!==m&&(f+=p.length)}return l&&(this.patch_addContext_(s,g),t.push(s)),t},h.prototype.patch_deepCopy=function(r){for(var e=[],n=0;n<r.length;n++){var a=r[n],i=new h.patch_obj;i.diffs=[];for(var t=0;t<a.diffs.length;t++)i.diffs[t]=new h.Diff(a.diffs[t][0],a.diffs[t][1]);i.start1=a.start1,i.start2=a.start2,i.length1=a.length1,i.length2=a.length2,e[n]=i}return e},h.prototype.patch_apply=function(r,e){if(r.length==0)return[e,[]];r=this.patch_deepCopy(r);var n=this.patch_addPadding(r);e=n+e+n,this.patch_splitMax(r);for(var a=0,i=[],t=0;t<r.length;t++){var s=r[t].start2+a,l=this.diff_text1(r[t].diffs),o,f=-1;if(l.length>this.Match_MaxBits?(o=this.match_main(e,l.substring(0,this.Match_MaxBits),s),o!=-1&&(f=this.match_main(e,l.substring(l.length-this.Match_MaxBits),s+l.length-this.Match_MaxBits),(f==-1||o>=f)&&(o=-1))):o=this.match_main(e,l,s),o==-1)i[t]=!1,a-=r[t].length2-r[t].length1;else{i[t]=!0,a=o-s;var g;if(f==-1?g=e.substring(o,o+l.length):g=e.substring(o,f+this.Match_MaxBits),l==g)e=e.substring(0,o)+this.diff_text2(r[t].diffs)+e.substring(o+l.length);else{var v=this.diff_main(l,g,!1);if(l.length>this.Match_MaxBits&&this.diff_levenshtein(v)/l.length>this.Patch_DeleteThreshold)i[t]=!1;else{this.diff_cleanupSemanticLossless(v);for(var _=0,b,p=0;p<r[t].diffs.length;p++){var M=r[t].diffs[p];M[0]!==u&&(b=this.diff_xIndex(v,_)),M[0]===c?e=e.substring(0,o+b)+M[1]+e.substring(o+b):M[0]===m&&(e=e.substring(0,o+b)+e.substring(o+this.diff_xIndex(v,_+M[1].length))),M[0]!==m&&(_+=M[1].length)}}}}}return e=e.substring(n.length,e.length-n.length),[e,i]},h.prototype.patch_addPadding=function(r){for(var e=this.Patch_Margin,n="",a=1;a<=e;a++)n+=String.fromCharCode(a);for(var a=0;a<r.length;a++)r[a].start1+=e,r[a].start2+=e;var i=r[0],t=i.diffs;if(t.length==0||t[0][0]!=u)t.unshift(new h.Diff(u,n)),i.start1-=e,i.start2-=e,i.length1+=e,i.length2+=e;else if(e>t[0][1].length){var s=e-t[0][1].length;t[0][1]=n.substring(t[0][1].length)+t[0][1],i.start1-=s,i.start2-=s,i.length1+=s,i.length2+=s}if(i=r[r.length-1],t=i.diffs,t.length==0||t[t.length-1][0]!=u)t.push(new h.Diff(u,n)),i.length1+=e,i.length2+=e;else if(e>t[t.length-1][1].length){var s=e-t[t.length-1][1].length;t[t.length-1][1]+=n.substring(0,s),i.length1+=s,i.length2+=s}return n},h.prototype.patch_splitMax=function(r){for(var e=this.Match_MaxBits,n=0;n<r.length;n++)if(!(r[n].length1<=e)){var a=r[n];r.splice(n--,1);for(var i=a.start1,t=a.start2,s="";a.diffs.length!==0;){var l=new h.patch_obj,o=!0;for(l.start1=i-s.length,l.start2=t-s.length,s!==""&&(l.length1=l.length2=s.length,l.diffs.push(new h.Diff(u,s)));a.diffs.length!==0&&l.length1<e-this.Patch_Margin;){var f=a.diffs[0][0],g=a.diffs[0][1];f===c?(l.length2+=g.length,t+=g.length,l.diffs.push(a.diffs.shift()),o=!1):f===m&&l.diffs.length==1&&l.diffs[0][0]==u&&g.length>2*e?(l.length1+=g.length,i+=g.length,o=!1,l.diffs.push(new h.Diff(f,g)),a.diffs.shift()):(g=g.substring(0,e-l.length1-this.Patch_Margin),l.length1+=g.length,i+=g.length,f===u?(l.length2+=g.length,t+=g.length):o=!1,l.diffs.push(new h.Diff(f,g)),g==a.diffs[0][1]?a.diffs.shift():a.diffs[0][1]=a.diffs[0][1].substring(g.length))}s=this.diff_text2(l.diffs),s=s.substring(s.length-this.Patch_Margin);var v=this.diff_text1(a.diffs).substring(0,this.Patch_Margin);v!==""&&(l.length1+=v.length,l.length2+=v.length,l.diffs.length!==0&&l.diffs[l.diffs.length-1][0]===u?l.diffs[l.diffs.length-1][1]+=v:l.diffs.push(new h.Diff(u,v))),o||r.splice(++n,0,l)}}},h.prototype.patch_toText=function(r){for(var e=[],n=0;n<r.length;n++)e[n]=r[n];return e.join("")},h.prototype.patch_fromText=function(r){var e=[];if(!r)return e;for(var n=r.split(`
`),a=0,i=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;a<n.length;){var t=n[a].match(i);if(!t)throw new Error("Invalid patch string: "+n[a]);var s=new h.patch_obj;for(e.push(s),s.start1=parseInt(t[1],10),t[2]===""?(s.start1--,s.length1=1):t[2]=="0"?s.length1=0:(s.start1--,s.length1=parseInt(t[2],10)),s.start2=parseInt(t[3],10),t[4]===""?(s.start2--,s.length2=1):t[4]=="0"?s.length2=0:(s.start2--,s.length2=parseInt(t[4],10)),a++;a<n.length;){var l=n[a].charAt(0);try{var o=decodeURI(n[a].substring(1))}catch{throw new Error("Illegal escape in patch_fromText: "+o)}if(l=="-")s.diffs.push(new h.Diff(m,o));else if(l=="+")s.diffs.push(new h.Diff(c,o));else if(l==" ")s.diffs.push(new h.Diff(u,o));else{if(l=="@")break;if(l!=="")throw new Error('Invalid patch mode "'+l+'" in: '+o)}a++}}return e},h.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},h.patch_obj.prototype.toString=function(){var r,e;this.length1===0?r=this.start1+",0":this.length1==1?r=this.start1+1:r=this.start1+1+","+this.length1,this.length2===0?e=this.start2+",0":this.length2==1?e=this.start2+1:e=this.start2+1+","+this.length2;for(var n=["@@ -"+r+" +"+e+` @@
`],a,i=0;i<this.diffs.length;i++){switch(this.diffs[i][0]){case c:a="+";break;case m:a="-";break;case u:a=" ";break}n[i+1]=a+encodeURI(this.diffs[i][1])+`
`}return n.join("").replace(/%20/g," ")},w.exports=h,w.exports.diff_match_patch=h,w.exports.DIFF_DELETE=m,w.exports.DIFF_INSERT=c,w.exports.DIFF_EQUAL=u})(T)),T.exports}var $=U();const z=`You are a grammar checker. Find ONLY grammar and spelling errors in the text.

CRITICAL RULES:
1. ONLY fix actual grammar mistakes (subject-verb agreement, tense errors, article usage, etc.)
2. ONLY fix spelling mistakes
3. DO NOT rewrite sentences for "clarity" or "style"
4. DO NOT change the meaning or structure of sentences
5. The "suggestion" must be minimal - change ONLY the specific word(s) with errors
6. If a sentence is grammatically correct, DO NOT suggest changes

IMPORTANT GRAMMAR RULES TO FOLLOW:
- After "doesn't", "don't", "does", "do", "didn't", "can't", "won't", "shouldn't", "couldn't", "wouldn't" → use BASE VERB (no -s/-es)
  Example: "doesn't work" is CORRECT, "doesn't works" is WRONG
- After "he/she/it" without auxiliary → use VERB+S
  Example: "it works" is CORRECT, "it work" is WRONG
- "its" = possessive, "it's" = "it is"

Respond ONLY with a JSON object. No markdown.

JSON Structure:
{
  "corrections": [
    {
      "type": "grammar" | "spelling",
      "original": "exact erroneous word or phrase",
      "suggestion": "corrected word or phrase", 
      "explanation": "brief reason",
      "start": number,
      "end": number,
      "severity": "error" | "warning"
    }
  ],
  "overallScore": 0-100,
  "stats": { "wordCount": number, "readabilityScore": 0-10 }
}

Examples:
- "sometimes it work" → "it work" should be "it works" (subject-verb agreement)
- "doesn't works" → "works" should be "work" (base verb after doesn't)
- "recieve" → "receive" (spelling)
- "a apple" → "an apple" (article)
- "its raining" → "its" should be "it's" (contraction)

DO NOT create correction loops. Analyze the FULL context before suggesting.`,N=new Map,j=1e3*60*5,C=3e3;async function Y(w,h){if(w.length<=C)return L(w,h);const m=G(w,C),c=await Promise.all(m.map(n=>L(n.text,h))),u={corrections:[],overallScore:0,stats:{wordCount:0,readabilityScore:0}};let r=0,e=0;return c.forEach((n,a)=>{const i=m[a].offset;n.corrections.forEach(t=>{t.start+=i,t.end+=i}),u.corrections.push(...n.corrections),u.stats.wordCount+=n.stats.wordCount,r+=n.overallScore,e+=n.stats.readabilityScore}),u.overallScore=Math.round(r/c.length),u.stats.readabilityScore=Number((e/c.length).toFixed(1)),u}async function L(w,h){const m=`${h.selectedModel}:${h.mode}:${h.aggressiveness}:${w}`,c=N.get(m);if(c&&Date.now()-c.timestamp<j)return c.response;if(!h.openRouterKey)throw new Error("OpenRouter API key is missing");const u=await fetch("https://openrouter.ai/api/v1/chat/completions",{method:"POST",headers:{Authorization:`Bearer ${h.openRouterKey}`,"Content-Type":"application/json","HTTP-Referer":"https://github.com/open-grammarly","X-Title":"Open Grammarly"},body:JSON.stringify({model:h.selectedModel,messages:[{role:"system",content:`${z}
Writing Mode: ${h.mode}
Aggressiveness: ${h.aggressiveness}`},{role:"user",content:w}],response_format:{type:"json_object"},temperature:.3})});if(!u.ok){const n=await u.json().catch(()=>({}));throw new Error(n.error?.message||`API request failed with status ${u.status}`)}const e=(await u.json()).choices[0].message.content;try{const n=JSON.parse(e),a=H(w,n);return N.set(m,{response:a,timestamp:Date.now()}),a}catch{throw new Error("Invalid response format from AI.")}}function G(w,h){const m=[];let c=0;for(;c<w.length;){let u=c+h;if(u<w.length){const r=w.lastIndexOf(`
`,u);if(r>c+h*.5)u=r+1;else{const e=w.lastIndexOf(". ",u);e>c+h*.5&&(u=e+2)}}else u=w.length;m.push({text:w.substring(c,u),offset:c}),c=u}return m}function H(w,h){const m=new $.diff_match_patch;return h.corrections=h.corrections.filter(c=>{if(w.substring(c.start,c.end)===c.original)return!0;const r=w.indexOf(c.original);if(r!==-1)return c.start=r,c.end=r+c.original.length,!0;const e=m.match_main(w,c.original,c.start);return e!==-1?(c.start=e,c.end=e+c.original.length,c.original=w.substring(c.start,c.end),!0):!1}),h}chrome.runtime.onInstalled.addListener(()=>{chrome.contextMenus.create({id:"analyzeSelection",title:"Analyze with Open Grammarly",contexts:["selection"]})});chrome.contextMenus.onClicked.addListener(async(w,h)=>{if(w.menuItemId==="analyzeSelection"&&w.selectionText&&h?.id)try{const m=await F(w.selectionText);chrome.tabs.sendMessage(h.id,{type:"SHOW_ANALYSIS_RESULTS",data:m})}catch{}});chrome.runtime.onMessage.addListener((w,h,m)=>{if(w.type==="PING"){m({success:!0,message:"PONG"});return}if(w.type==="OPEN_OPTIONS"){chrome.runtime.openOptionsPage(),m({success:!0});return}if(w.type==="ANALYZE_TEXT")return F(w.text).then(c=>{m(c)}),!0});async function F(w){try{const h=await B();return h.openRouterKey?h.enabled?{success:!0,data:await Y(w,h)}:{success:!1,error:"Extension is disabled"}:{success:!1,error:"API key not set. Please open extension options and enter your OpenRouter key."}}catch(h){return{success:!1,error:h.message}}}
